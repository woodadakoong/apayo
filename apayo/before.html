<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>아파용</title>
</head>
<body>
<div style="display: flex; flex-direction: row; height: 100vh;">
  <div style="width: 70%;">
    <div id="map" style="width: 100%; height: 100%;"></div>
  </div>
  <div style="width: 30%; padding: 10px;">
    <div id="address"></div>
  </div>
</div>

<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=e639683ac02e3543cc5a094643bd765e&libraries=services"></script>
<script>
var infowindow;
var currentPosition;
var mapContainer = document.getElementById('map');
var ps = new kakao.maps.services.Places();
var keyword = '용인시 기흥구 학교'; // 키워드 입력

if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
        var lat = position.coords.latitude;
        var lon = position.coords.longitude;
        currentPosition = new kakao.maps.LatLng(lat, lon);

        var map = new kakao.maps.Map(mapContainer, { center: currentPosition, level: 3 });

        var marker = new kakao.maps.Marker({
            map: map,
            position: currentPosition
        });

        var content = '<div style="padding:5px;font-size:12px;">현위치</div>';
        infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });
        infowindow.setContent(content);
        infowindow.open(map, marker);
        
        searchPlaces(keyword, map); // 설정한 키워드로 검색
        
        // 주소 정보 얻기
        var geocoder = new kakao.maps.services.Geocoder();
        geocoder.coord2RegionCode(lon, lat, function(result, status) {
            if (status === kakao.maps.services.Status.OK) {
                var address = result[0].address_name;
                var addressDiv = document.getElementById('address');
                addressDiv.innerHTML = '현재 주소: ' + address;
            }
        });
    });
}

function searchPlaces(keyword, map) {
    ps.keywordSearch(keyword, function(data, status, pagination) {
        if (status === kakao.maps.services.Status.OK) {
            var bounds = new kakao.maps.LatLngBounds();

            for (var i = 0; i < data.length; i++) {
                displayMarker(data[i], map);
                bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
            }
        }
    }); 
}

function displayMarker(place, map) {
    var marker = new kakao.maps.Marker({
        map: map,
        position: new kakao.maps.LatLng(place.y, place.x) 
    });

    kakao.maps.event.addListener(marker, 'click', function() {
        infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>');
        infowindow.open(map, marker);

        var destination = new kakao.maps.LatLng(place.y, place.x);
        var start = currentPosition;
        var url = 'https://map.kakao.com/link/to/' + encodeURIComponent(place.place_name) + ',' + destination.getLat() + ',' + destination.getLng() + '?by=SP&start=' + start.getLat() + ',' + start.getLng();

        var linkHtml = '<a href="' + url + '" target="_blank">길찾기</a>';
        infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place.place_name + '<br>' + linkHtml + '</div>');
    });
}
</script>
</body>
</html>
